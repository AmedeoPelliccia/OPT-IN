{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://ampel360.com/schemas/ata16/safety-assessment.schema.json",
  "title": "Safety Assessment Schema",
  "description": "Schema for safety assessments associated with role changes, including hazard analysis, mitigation strategies, and regulatory compliance",
  "type": "object",
  "required": [
    "assessment_id",
    "assessment_type",
    "change_request_ref",
    "assessment_date",
    "hazard_analysis",
    "mitigation_strategy",
    "regulatory_compliance",
    "approvals"
  ],
  "properties": {
    "assessment_id": {
      "type": "string",
      "pattern": "^SA-[0-9]{4}-[0-9]{4}$",
      "description": "Unique safety assessment identifier (e.g., SA-2025-0001)"
    },
    "assessment_type": {
      "type": "string",
      "enum": [
        "FHA",
        "PSSA",
        "SSA",
        "FTA",
        "FMEA",
        "CCA",
        "ZSA"
      ],
      "description": "Type of safety assessment (FHA: Functional Hazard Assessment, PSSA: Preliminary System Safety Assessment, SSA: System Safety Assessment, FTA: Fault Tree Analysis, FMEA: Failure Modes and Effects Analysis, CCA: Common Cause Analysis, ZSA: Zonal Safety Assessment)"
    },
    "title": {
      "type": "string",
      "description": "Title of the safety assessment"
    },
    "description": {
      "type": "string",
      "description": "Detailed description of the assessment scope and objectives"
    },
    "change_request_ref": {
      "type": "string",
      "pattern": "^(ECR|NCR)-[0-9]{4}-[0-9]{4}$",
      "description": "Reference to associated change request"
    },
    "assessment_date": {
      "type": "string",
      "format": "date",
      "description": "Date the assessment was completed (ISO 8601: YYYY-MM-DD)"
    },
    "system_description": {
      "type": "object",
      "properties": {
        "ata_chapter": {
          "type": "string",
          "pattern": "^ATA[_-]?[0-9]{2}$",
          "description": "Primary ATA chapter"
        },
        "system_name": {
          "type": "string",
          "description": "Name of system being assessed"
        },
        "current_role": {
          "type": "string",
          "description": "Current role or function"
        },
        "proposed_role": {
          "type": "string",
          "description": "Proposed new role or function"
        },
        "interfaces": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "System interfaces that may be affected"
        }
      }
    },
    "hazard_analysis": {
      "type": "object",
      "required": ["hazards", "safety_objectives"],
      "properties": {
        "hazards": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": [
              "hazard_id",
              "hazard_description",
              "failure_condition",
              "classification",
              "probability"
            ],
            "properties": {
              "hazard_id": {
                "type": "string",
                "description": "Unique hazard identifier (e.g., HAZ-001)"
              },
              "hazard_description": {
                "type": "string",
                "description": "Description of the hazard"
              },
              "failure_condition": {
                "type": "string",
                "description": "Failure condition that could result in the hazard"
              },
              "classification": {
                "type": "string",
                "enum": [
                  "Catastrophic",
                  "Hazardous",
                  "Major",
                  "Minor",
                  "No_Safety_Effect"
                ],
                "description": "Hazard classification per ARP4761"
              },
              "probability": {
                "type": "string",
                "enum": [
                  "Extremely_Improbable",
                  "Extremely_Remote",
                  "Remote",
                  "Probable",
                  "Frequent"
                ],
                "description": "Probability of occurrence"
              },
              "dal": {
                "type": "string",
                "enum": ["A", "B", "C", "D", "E"],
                "description": "Design Assurance Level (DAL) per DO-178C / DO-254"
              },
              "affected_phases": {
                "type": "array",
                "items": {
                  "type": "string",
                  "enum": [
                    "Ground",
                    "Taxi",
                    "Takeoff",
                    "Climb",
                    "Cruise",
                    "Descent",
                    "Approach",
                    "Landing",
                    "All_Phases"
                  ]
                },
                "description": "Flight phases affected by hazard"
              },
              "crew_action_required": {
                "type": "boolean",
                "description": "Whether crew action is required to mitigate"
              }
            }
          }
        },
        "safety_objectives": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["objective_id", "objective_description", "quantitative_requirement"],
            "properties": {
              "objective_id": {
                "type": "string",
                "description": "Unique safety objective identifier"
              },
              "objective_description": {
                "type": "string",
                "description": "Description of the safety objective"
              },
              "quantitative_requirement": {
                "type": "string",
                "description": "Quantitative safety requirement (e.g., probability per flight hour)"
              },
              "verification_method": {
                "type": "string",
                "enum": [
                  "Analysis",
                  "Test",
                  "Inspection",
                  "Demonstration",
                  "Review_of_Design"
                ],
                "description": "Method to verify objective is met"
              }
            }
          }
        }
      }
    },
    "mitigation_strategy": {
      "type": "object",
      "required": ["mitigations"],
      "properties": {
        "mitigations": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [
              "mitigation_id",
              "hazard_id_ref",
              "mitigation_type",
              "mitigation_description",
              "effectiveness"
            ],
            "properties": {
              "mitigation_id": {
                "type": "string",
                "description": "Unique mitigation identifier"
              },
              "hazard_id_ref": {
                "type": "string",
                "description": "Reference to hazard being mitigated"
              },
              "mitigation_type": {
                "type": "string",
                "enum": [
                  "Design_Change",
                  "Procedural_Control",
                  "Training",
                  "Redundancy",
                  "Monitoring",
                  "Warning_System",
                  "Inspection",
                  "Maintenance_Action"
                ],
                "description": "Type of mitigation"
              },
              "mitigation_description": {
                "type": "string",
                "description": "Detailed description of mitigation"
              },
              "effectiveness": {
                "type": "string",
                "enum": ["High", "Medium", "Low"],
                "description": "Effectiveness of mitigation"
              },
              "implementation_status": {
                "type": "string",
                "enum": ["Planned", "In_Progress", "Implemented", "Verified"],
                "description": "Status of mitigation implementation"
              },
              "verification_ref": {
                "type": "string",
                "description": "Reference to verification evidence (test report, inspection record)"
              }
            }
          }
        },
        "residual_risk": {
          "type": "object",
          "required": ["assessment", "acceptability"],
          "properties": {
            "assessment": {
              "type": "string",
              "description": "Assessment of residual risk after mitigations"
            },
            "acceptability": {
              "type": "string",
              "enum": [
                "Acceptable",
                "Acceptable_with_Conditions",
                "Unacceptable"
              ],
              "description": "Acceptability of residual risk"
            },
            "conditions": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Conditions for acceptance (if applicable)"
            }
          }
        }
      }
    },
    "regulatory_compliance": {
      "type": "object",
      "required": ["applicable_regulations", "compliance_demonstration"],
      "properties": {
        "applicable_regulations": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["regulation", "clause"],
            "properties": {
              "regulation": {
                "type": "string",
                "description": "Regulation identifier (e.g., CS-25, 14 CFR Part 25)"
              },
              "clause": {
                "type": "string",
                "description": "Specific clause or section"
              },
              "requirement": {
                "type": "string",
                "description": "Regulatory requirement summary"
              },
              "applicability": {
                "type": "string",
                "enum": ["Applicable", "Not_Applicable", "TBD"],
                "description": "Applicability to this change"
              }
            }
          }
        },
        "compliance_demonstration": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["regulation_ref", "method", "evidence_ref"],
            "properties": {
              "regulation_ref": {
                "type": "string",
                "description": "Reference to regulation being addressed"
              },
              "method": {
                "type": "string",
                "enum": [
                  "Analysis",
                  "Test",
                  "Similarity",
                  "Service_Experience",
                  "Certification_by_Analysis"
                ],
                "description": "Method of compliance"
              },
              "evidence_ref": {
                "type": "string",
                "description": "Reference to compliance evidence"
              },
              "status": {
                "type": "string",
                "enum": ["Planned", "In_Progress", "Complete", "Accepted"],
                "description": "Status of compliance demonstration"
              }
            }
          }
        },
        "certification_impact": {
          "type": "object",
          "properties": {
            "impact_level": {
              "type": "string",
              "enum": [
                "No_Impact",
                "Minor_Change",
                "Major_Change",
                "Requires_STC",
                "Requires_TCDS_Amendment"
              ],
              "description": "Level of certification impact"
            },
            "authority_coordination": {
              "type": "string",
              "description": "Details of coordination with certification authority"
            }
          }
        }
      }
    },
    "assumptions": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["assumption_id", "assumption_description"],
        "properties": {
          "assumption_id": {
            "type": "string",
            "description": "Unique assumption identifier"
          },
          "assumption_description": {
            "type": "string",
            "description": "Description of assumption made in assessment"
          },
          "validation_status": {
            "type": "string",
            "enum": ["Validated", "Pending_Validation", "Invalid"],
            "description": "Status of assumption validation"
          }
        }
      }
    },
    "approvals": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["role", "reviewer_id", "timestamp", "status"],
        "properties": {
          "role": {
            "type": "string",
            "enum": [
              "Safety_Engineering",
              "Airworthiness",
              "Chief_Engineer",
              "Certification_Authority"
            ],
            "description": "Role of approver"
          },
          "reviewer_id": {
            "type": "string",
            "description": "Unique identifier of reviewer"
          },
          "reviewer_name": {
            "type": "string",
            "description": "Name of reviewer"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "Approval timestamp (ISO 8601 with timezone)"
          },
          "status": {
            "type": "string",
            "enum": ["Approved", "Rejected", "Conditionally_Approved"],
            "description": "Approval status"
          },
          "comment": {
            "type": "string",
            "description": "Reviewer comment"
          }
        }
      }
    },
    "traceability": {
      "type": "object",
      "properties": {
        "related_assessments": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "References to related safety assessments"
        },
        "test_reports": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "References to supporting test reports"
        },
        "document_checksums": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "document_id": {"type": "string"},
              "algorithm": {"type": "string", "enum": ["sha256"]},
              "value": {"type": "string", "pattern": "^[a-fA-F0-9]{64}$"}
            }
          }
        }
      }
    },
    "notes": {
      "type": "string",
      "description": "Additional notes or clarifications"
    }
  }
}
