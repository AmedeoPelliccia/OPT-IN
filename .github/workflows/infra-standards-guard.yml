name: Infra Standards Guard

on:
  pull_request:
    paths:
      - "OPT-IN FRAMEWORK/I-INFRASTRUCTURES/ATA_85-90-INFRASTRUCTURE_INTERFACE_STANDARDS/**"
  push:
    branches:
      - main
    paths:
      - "OPT-IN FRAMEWORK/I-INFRASTRUCTURES/ATA_85-90-INFRASTRUCTURE_INTERFACE_STANDARDS/**"

jobs:
  validate:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          
      - name: Install Python dependencies
        run: |
          pip install pyyaml jsonschema
          
      - name: Install Node dependencies
        run: |
          npm install -g @redocly/cli
          
      - name: Validate metadata sidecars against schema
        run: |
          echo "Validating metadata sidecars..."
          python ci/validate_meta.py \
            --schema "OPT-IN FRAMEWORK/I-INFRASTRUCTURES/ATA_85-90-INFRASTRUCTURE_INTERFACE_STANDARDS/schemas/meta_v1_1.json" \
            "OPT-IN FRAMEWORK/I-INFRASTRUCTURES/ATA_85-90-INFRASTRUCTURE_INTERFACE_STANDARDS"
        continue-on-error: true
        
      - name: Lint OpenAPI specs
        run: |
          echo "Linting OpenAPI specifications..."
          find "OPT-IN FRAMEWORK/I-INFRASTRUCTURES/ATA_85-90-INFRASTRUCTURE_INTERFACE_STANDARDS" \
            -name "API_STD-*.yml" \
            -exec npx @redocly/cli lint {} \;
        continue-on-error: true
        
      - name: Verify digital signatures
        run: |
          echo "Verifying digital signatures..."
          python ci/verify_sigs.py \
            "OPT-IN FRAMEWORK/I-INFRASTRUCTURES/ATA_85-90-INFRASTRUCTURE_INTERFACE_STANDARDS"
        continue-on-error: true
        
      - name: Check for broken links
        run: |
          echo "Checking for broken links and compliance chain..."
          # This would run a link checker script
          echo "âš  Link checking not yet implemented"
        continue-on-error: true
        
      - name: Summary
        run: |
          echo "::notice::Infrastructure standards validation complete"
          echo "Review any warnings above for compliance issues"
